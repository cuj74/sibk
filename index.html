<html>
    <head>
        <meta name="author" content="Urban Johansson">
        <meta name=”viewport” content=”width=device-width, initial-scale=1.0">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
        <link rel=”stylesheet” href=”css/bootstrap-responsive.css”>
<script type="application/javascript">
function populateinventory() {
  let inventorydata;    
  fetch("https://raw.githubusercontent.com/cuj74/sibk/main/inventory.json").then(
          function(u){ return u.json();}
        ).then(
          function(json){
            var itable = document.getElementById("inventory");
            for (const [key, value] of Object.entries(json.sortiment)) {

              var newRow = itable.insertRow();

              var newCellkey = newRow.insertCell();
              newCellkey.innerHTML = "<h4>"+`${value.item}`+"</h4>";


              var newCellval = newRow.insertCell();
              newCellval.innerHTML = "<h4><div id=\""+`${value.item}` + "\">" + `${value.amount}` + "</div></h4>";

              var addButton = newRow.insertCell();
              addButton.innerHTML = "<div class=\"btn btn-primary\" onclick=\"add('" + `${value.item}` + "')\"><h4>+</h4></div>";

              var removeButton = newRow.insertCell();
              removeButton.innerHTML = "<div class=\"btn btn-secondary\" onclick=\"remove('" + `${value.item}` + "')\" ><h4>-</h4></div>";
                          
            }
          }
        );
}


var Ordernum = 1;
var itemlist = new Array();
var addaction = true;

function add(kitem) {  
    itemlist.push(kitem);
    addaction = true;
    orderinformation();
}
function remove(kitem) {  
   
    var idx = itemlist.findIndex(fitem => fitem == kitem);
    if (idx > -1)
    {
      itemlist.splice(idx,1); 
      addaction = false;
      orderinformation();
    }
}

function emptycart() {  
    document.getElementById("total").innerHTML = "0";
    document.getElementById("cart").innerHTML = "";
    if (itemlist.length > 0)
    {
        itemlist = [];
        Ordernum++;
    }
}
function orderinformation()
{
    document.getElementById("cart").innerHTML = "";
    var count = {};

    for (let index = 0; index < itemlist.length; index++) {
    const element = itemlist[index];

    if (count[element]) {
            count[element] += 1;
        } else {
            count[element] = 1;
        }
    }

    let totalorderamount = 0;

    var rtable = document.getElementById("cart");
    while(rtable.rows.length > 1) rtable.rows[1].remove();

    if (itemlist.length > 0) 
    {
      var headerrow = rtable.insertRow();

      var headerCellkey = headerrow.insertCell();
      headerCellkey.colSpan="3";
      headerCellkey.innerHTML = "<h4>Order " + Ordernum +"</h4>";
      
    }

    var tbodyRef = document.getElementById('cart');

    for (const [key, value] of Object.entries(count)) {
        let itemtotal = parseInt(document.getElementById(key).innerHTML)*parseInt(value);
        totalorderamount = totalorderamount + itemtotal;

        var newRow = tbodyRef.insertRow();

        var newCellval = newRow.insertCell();
        var newTextval = document.createTextNode(`${value}`);
        newCellval.appendChild(newTextval);     

        var newCellkey = newRow.insertCell();
        var newTextkey = document.createTextNode(`${key}`);
        newCellkey.appendChild(newTextkey);     

        var newCelltot = newRow.insertCell();
        var newTexttot = document.createTextNode(`${itemtotal}`);
        newCelltot.appendChild(newTexttot);     

    }
    if (totalorderamount > 0)
    {
        flashTotal();
    }

    document.getElementById("total").innerHTML = totalorderamount;  

}

function flashTotal() {
  var ordertext = document.getElementById("total");
  
  var typeofhighlight = "highlight"
  if (!addaction)
    typeofhighlight = "lowlight";

  ordertext.classList.add(typeofhighlight);
  setTimeout(function(){
    ordertext.classList.remove(typeofhighlight);
  }, 200)
}

</script>
<style>body 
  {background-color: #495057;}
  #orderfloat {
    display: inline-block;
    vertical-align: top;
  }
  .highlight{
    color: #10FF80;
  }
  .lowlight{
    color: #FF5580;
  }
</style>
    </head>
    <body>
        <div class=”jumbotron”>
            <table class="table table-dark" id="orderfloat">
                <tr>
                    <td width="300"><h1>Summa&nbsp;<span id="total">0</span> kr</h1></td>
                    <td><div class="btn btn-primary" onclick="emptycart()">Rensa</div></td>
                </tr>
            </table>
            <table id="inventory" cellspacing="0" cellpadding="0" class="table table-dark"></table>
            <script type="application/javascript">populateinventory();</script>
            <table id="cart" class="table table-dark"></table>
            <span class="text-muted">v 0.1</span>
        </div>
    </body>
</html>